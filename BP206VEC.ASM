*****************************************************************************
*       Вектора прерываний
* $Id: BP206VEC.ASM,v 1.11 2001-05-28 10:06:25 peter Exp $
*****************************************************************************
*
        .text
*
        B    INIT      ; 0h   RS         1   Начальные установки
        B    INTU      ; 2h   HOLD/INT1  4   Мало U батарей(INT1)
        B    INTKEY    ; 4h   INT2/INT3  5   Кнопка
        B    INTTIM    ; 6h   TINT       6   Таймер частоты дискретизации
        B    INIT      ; 8h   RINT       7   Синхронный порт прием ЗАМАСКИРОВ
        B    INIT      ; Ah   XINT       8   Синхронный порт перед.ЗАМАСКИРОВ
        B    INTASP    ; Ch   TXRXINT    9   Асинхронный порт
        B    INIT      ; Eh              10  Reserved
        B    INIT      ; 10h             11  Reserved
        B    INIT      ; 12h             12  Reserved
        B    INIT      ; 14h             13  Reserved
        B    INIT      ; 16h             14  Reserved
        B    INIT      ; 18h             15  Reserved
        B    INIT      ; 1Ah             16  Reserved
        B    INIT      ; 1Ch             17  Reserved
        B    INIT      ; 1Eh  INT15      -
        B    INIT      ; 20h  INT16      -
        B    INIT      ; 22h  TRAP       -  Вектор инструкции TRAP
        B    INIT      ; 24h  NMI        3
	B    INIT      ; 26h             2  Reserved
	.word	0FFFFh,0FFFFh

* сигнатура
* один байт  - размер сектора
* один байт  - информация о приборе
* четыре байта - номер прибора
* пять байт  - номер версии
* байт       - Поддержка хранения таблицы результатов "минутных" измерений
* байт       - поддерживает хранение пульсовых волн
* байт       - поддерживает хранение ЭКГ
* два байта  - максимальное количество процессов измерений
***********************************************************
* Раздел описания таблицы результатов "минутных" измерений
***********************************************************
* байт       - есть ли компрессия
* слово      - Максимальное количество отсчетов в процессе измерения
* слово      - Частота дискретизации (отсчет / час)
* байт       - Фактическое количество массивов в процессе измерения (<=8)
********************************************************
*    * Таблица описания сигналов (сейчас 8)
********************************************************
* Формат одного элемента таблицы описания сигналов (TSampleDef)
* байт  - тип данных (1 - Word, 2 - Integer, 3 - Byte, 4 - ShortInt)
* байт  - источник сигнала
*        (0 - давление в манжете, 1 - ЭКГ, 2 - сигнал с микрофона)
* слово - значение полной шкалы
*         (наибольшего положительного значения)
*         для используемого типа данных,
*         в принятых физ. единицах (для давления - мм рт.ст.)
* слово - минимально возможное значение
*        (может иметь произвольный знак) сигнала, в принятых физ. единицах
* слово - значение базового уровня сигнала
*         (к которому надо прибавлять значения элементов массива),
*         в принятых физ. единицах
***************************************
* Раздел описания процессов измерений
***************************************
* байт       - есть ли компрессия
* слово      - максимальное количество отсчетов
* слово      - частота дискретизации
* байт       - количество массивов
***************************************************************
*   * потом идут записи описания для каждого сигнала (сейчас 8)
***************************************************************
* байт       - тип данных
*            (1 - Word, 2 - Integer, 3 - Byte, 4 - ShortInt)
* байт       - источник сигнала
*             (0 - давление в манжете, 1 - ЭКГ, 2 - сигнал с микрофона)
* слово      - значение полной шкалы (наибольшего
*               положительного значения) для типа данных,
*               указанного в DataType, в принятых физ. единицах} {320}
* слово      - минимально возможное значение
*            (может иметь произвольный знак) сигнала,
*            в принятых физ. единицах
* слово      - значение базового уровня сигнала
*            (к которому надо прибавлять значения элементов массива),
*            в принятых физ. единицах
*****************************************************
* Раздел описания непрерывных записей сигналов
*****************************************************
* байт       - есть ли компрессия
* слово - Максимальное количество отсчетов в процессе измерения
*         (фиктивный параметр)
* слово - Частота дискретизации ( отсчетов/ сек)
* байт  - Фактическое количество массивов в процессе измерения (<=8)
******************************************************
*    * Таблица описания сигналов
******************************************************
* байт       - тип данных
*            (1 - Word, 2 - Integer, 3 - Byte, 4 - ShortInt)
* байт       - источник сигнала
*             (0 - давление в манжете, 1 - ЭКГ, 2 - сигнал с микрофона)
* слово      - значение полной шкалы (наибольшего
*               положительного значения) для типа данных,
*               указанного в DataType, в принятых физ. единицах}
* слово      - минимально возможное значение
*            (может иметь произвольный знак) сигнала,
*            в принятых физ. единицах
* слово      - значение базового уровня сигнала
*            (к которому надо прибавлять значения элементов массива),
*            в принятых физ. единицах
SIGNT:
 .if Mem=20	;одна микросхема на 2 Mbyte
   .word   005h
 .elseif Mem=40	;одна микросхема на 4 Mbyte
   .word   006h
 .else
  .emsg _ERROR __ MISSING PARAMETER_
 .endif


 .if PsevdoEKG=1		;есть массив для записи псевдо-ЭКГ?
ParamBit2 .set (1<<2)
 .else
ParamBit2 .set 0
 .endif

 .if ChannelEKG=1		;есть канал ЭКГ (программно пишется?)
ParamBit1 .set (1<<1)
 .else
ParamBit1 .set 0
 .endif
 .if Sertificarion=1
ParamBit3 .set (1<<3)
 .else
ParamBit3 .set 0
 .endif

	.word   ParamBit1|ParamBit2|ParamBit3
        ; бит   - значение
        ; 0     - есть отладочный режим
        ; 1     - есть ЭКГ
        ; 2     - есть массив для записи псевдо-ЭКГ
        ; 3     - сертификационная версия
	.word   0FFh,0FFh,0FFh,0FFh  ;серийный номер прибора
        ;версия ПО "00.04"
        ;первая цифра будет отвечать за версию аппаратуры
        ; '0' - старая плата (паралельная флеш или последовательная с дешифратором)
        ; '1' - новая плата (с дешифратором и AVR)
        .if VersionFerrum=1		;без дешифратора
	 .word   030h    
        .elseif VersionFerrum=2        ;с дешифратором
	 .word   031h
	.else
  	 .emsg _ERROR __ MISSING PARAMETER_
 	.endif
        .word   030h
        .word   02eh ; "." (точка)
        .word   030h
        .word   034h
	.word   0	;5A детский взрослый, A5 взрослый режим
	;Поддержка хранения таблицы
	;результатов "минутных" измерений
	.word   0FFh  ;пульсовые волны есть
	.word   000h  ;ЭКГ пока нет
	.word   0FFh,0h ; максимальное количество процессов измерений
***********************************************************
* Раздел описания таблицы результатов "минутных" измерений
***********************************************************
        .word   000h  ;компрессии нет
        .word   0,100 ; максимальное количество отсчетов (25600 байт)
        .word   0,60  ; Частота дискретизации (отсчет / час)
        .word   0     ; Фактическое количество массивов в процессе измерения
******************************************************
*    *  Таблица описания сигналов "минутных" измерений (8 шт)
******************************************************
* Формат одного элемента таблицы описания сигналов (TSampleDef)
* байт  - тип данных (1 - Word, 2 - Integer, 3 - Byte, 4 - ShortInt)
* байт  - источник сигнала
*        (0 - давление в манжете, 1 - ЭКГ, 2 - сигнал с микрофона)
* слово - значение полной шкалы
*         (наибольшего положительного значения)
*         для используемого типа данных,
*         в принятых физ. единицах (для давления - мм рт.ст.)
* слово - минимально возможное значение
*        (может иметь произвольный знак) сигнала, в принятых физ. единицах
* слово - значение базового уровня сигнала
*         (к которому надо прибавлять значения элементов массива),
*         в принятых физ. единицах
 .word 0, 0, 0,0, 0,0, 0,0   ; 1
 .word 0, 0, 0,0, 0,0, 0,0   ; 2
 .word 0, 0, 0,0, 0,0, 0,0   ; 3
 .word 0, 0, 0,0, 0,0, 0,0   ; 4
 .word 0, 0, 0,0, 0,0, 0,0   ; 5
 .word 0, 0, 0,0, 0,0, 0,0   ; 6
 .word 0, 0, 0,0, 0,0, 0,0   ; 7
 .word 0, 0, 0,0, 0,0, 0,0   ; 8
***************************************
* Раздел описания процессов измерений
***************************************
* слово      - максимальное количество отсчетов
* слово      - частота дискретизации (отсчетов/ сек)
* байт       - количество массивов
        .word   000h  ;компрессии нет
        .word   0,100 ; максимальное количество отсчетов (25600 байт)
        .word   100,0  ;частота дискретизации
*        .word   2      ;количество массивов
 .if PsevdoEKG=1
	.word   3      ;количество массивов
 .elseif ChannelEKG=1
	.word   3      ;количество массивов
 .else
	.word   1      ;количество массивов
 .endif
***************************************************************
*   * записи описания для каждого сигнала (сейчас 8)
***************************************************************
* байт       - тип данных
*            (1 - Word, 2 - Integer, 3 - Byte, 4 - ShortInt)
* байт       - источник сигнала
*             (0 - давление в манжете, 1 - ЭКГ, 2 - сигнал с микрофона)
* слово      - значение полной шкалы (наибольшего
*               положительного значения) для типа данных,
*               указанного в DataType, в принятых физ. единицах} {320}
* слово      - минимально возможное значение
*            (может иметь произвольный знак) сигнала,
*            в принятых физ. единицах
* слово      - значение базового уровня сигнала
*            (к которому надо прибавлять значения элементов массива),
*            в принятых физ. единицах
 .word 1,0, 64,1, 0,0, 0,0 ;1
 .word 1,1, 30,0, 0,0, 0,0 ;2
 .word 1,1, 30,0, 0,0, 0,0 ;3
 .word 0,0, 0,0,  0,0, 0,0 ;4
 .word 0,0, 0,0,  0,0, 0,0 ;5
 .word 0,0, 0,0,  0,0, 0,0 ;6
 .word 0,0, 0,0,  0,0, 0,0 ;7
 .word 0,0, 0,0,  0,0, 0,0 ;8
*****************************************************
* Раздел описания непрерывных записей сигналов
*****************************************************
* слово - Максимальное количество отсчетов в процессе измерения
*         (фиктивный параметр)
* слово - Частота дискретизации ( отсчетов/ сек)
* байт  - Фактическое количество массивов в процессе измерения (<=8)
        .word   000h  ;компрессии нет
        .word   0,0   ; максимальное количество отсчетов (фиктивный)
        .word   0,60  ; Частота дискретизации (отсчет / сек)
        .word   0     ; Фактическое количество массивов в процессе измерения
******************************************************
*    * Таблица описания сигналов
******************************************************
* байт       - тип данных
*            (1 - Word, 2 - Integer, 3 - Byte, 4 - ShortInt)
* байт       - источник сигнала
*             (0 - давление в манжете, 1 - ЭКГ, 2 - сигнал с микрофона)
* слово      - значение полной шкалы (наибольшего
*               положительного значения) для типа данных,
*               указанного в DataType, в принятых физ. единицах}
* слово      - минимально возможное значение
*            (может иметь произвольный знак) сигнала,
*            в принятых физ. единицах
* слово      - значение базового уровня сигнала
*            (к которому надо прибавлять значения элементов массива),
*            в принятых физ. единицах
 .word 0, 0, 0,0, 0,0, 0,0   ; 1
 .word 0, 0, 0,0, 0,0, 0,0   ; 2
 .word 0, 0, 0,0, 0,0, 0,0   ; 3
 .word 0, 0, 0,0, 0,0, 0,0   ; 4
 .word 0, 0, 0,0, 0,0, 0,0   ; 5
 .word 0, 0, 0,0, 0,0, 0,0   ; 6
 .word 0, 0, 0,0, 0,0, 0,0   ; 7
 .word 0, 0, 0,0, 0,0, 0,0   ; 8

LengthSignat .set $-SIGNT
*
